=====================================
   DOSTUP — Инструкция по установке
        для Linux (Ubuntu/Debian)
=====================================

ШАГ 1: Подключитесь к серверу по SSH

   ssh root@ваш_сервер

ШАГ 2: Скачайте установочный скрипт

   wget https://raw.githubusercontent.com/RichardMoor75/dostup_vpn/master/dostup-install.sh

ШАГ 3: Запустите установку

   sudo bash dostup-install.sh

ШАГ 4: Введите URL подписки

   • Скрипт запросит ссылку на подписку
   • Вставьте URL и нажмите Enter

ШАГ 5: Готово!

   Dostup VPN установлен и запущен как systemd-сервис.
   Управление через команду: sudo dostup <команда>

=====================================
       КАК ПОЛЬЗОВАТЬСЯ
=====================================

Команды управления:

   ┌──────────────────────────────────────────────────────┐
   │  sudo dostup start            │ Запустить VPN      │
   │  sudo dostup stop             │ Остановить VPN     │
   │  sudo dostup restart          │ Перезапуск +       │
   │                               │ обновление         │
   │  sudo dostup status           │ Показать статус    │
   │  dostup check                 │ Проверить доступ   │
   │  dostup update-providers      │ Обновить прокси    │
   │                               │ и правила          │
   │  dostup healthcheck           │ Проверить какие    │
   │                               │ ноды живые         │
   │  dostup log                   │ Логи (live)        │
   │  sudo dostup uninstall        │ Удалить            │
   │  dostup help                  │ Справка            │
   └──────────────────────────────────────────────────────┘

-------------------------------------
ПРОВЕРКА ДОСТУПА
-------------------------------------
Выполните: dostup check

Скрипт проверит доступ к сайтам через прокси:
   ✓ instagram.com — доступен (200)
   ✓ youtube.com — доступен (200)
   ✗ rutracker.org — недоступен (000)

Если сайты недоступны — VPN не работает или не запущен.

Изменить список сайтов для проверки:
   Отредактируйте файл /opt/dostup/sites.json

-------------------------------------
ИСПОЛЬЗОВАНИЕ ПРОКСИ
-------------------------------------

VPN работает как локальный прокси на порту 7890
(порт может быть другим — см. вывод установщика).

Способ 1: Разовый запуск через прокси

   HTTPS_PROXY=http://127.0.0.1:7890 HTTP_PROXY=http://127.0.0.1:7890 curl ifconfig.me

Способ 2: Алиасы в ~/.bashrc (рекомендуется)

   Добавьте в конец файла ~/.bashrc:

   alias px='HTTPS_PROXY=http://127.0.0.1:7890 HTTP_PROXY=http://127.0.0.1:7890'
   alias codex='px codex'
   alias claude='px claude'
   alias npm='px npm'
   alias pip='px pip'
   alias docker='px docker'

   Затем выполните: source ~/.bashrc
   Теперь команды codex, claude, npm, pip, docker
   будут автоматически ходить через прокси.

Способ 3: Прокси для всей сессии

   export HTTPS_PROXY=http://127.0.0.1:7890
   export HTTP_PROXY=http://127.0.0.1:7890

   Все программы в текущей сессии будут использовать прокси.
   Для отключения закройте терминал или выполните:
   unset HTTPS_PROXY HTTP_PROXY

-------------------------------------
ОБНОВЛЕНИЕ КОНФИГА И ЯДРА
-------------------------------------
Выполните: sudo dostup restart

Скрипт автоматически:
   • Проверит обновление ядра Mihomo
   • Скачает свежий конфиг по URL подписки
   • Обновит geo-базы (раз в 14 дней)
   • Перезапустит сервис

-------------------------------------
СМЕНА URL ПОДПИСКИ
-------------------------------------
Если нужно изменить подписку:

1. Откройте файл настроек:
   nano /opt/dostup/settings.json

2. Измените значение "subscription_url"

3. Перезапустите: sudo dostup restart

-------------------------------------
АВТОЗАГРУЗКА
-------------------------------------
Dostup автоматически запускается при загрузке
сервера (systemd-сервис). Дополнительная настройка
не требуется.

Отключить автозагрузку:
   sudo systemctl disable dostup

Включить обратно:
   sudo systemctl enable dostup

-------------------------------------
ВОЗМОЖНЫЕ ПРОБЛЕМЫ
-------------------------------------

Не запускается / ошибка в логах:
   → Проверьте логи: dostup log
   → Или: journalctl -u dostup -n 50
   → Проверьте конфиг: cat /opt/dostup/config.yaml

Порт занят:
   → Скрипт автоматически находит свободный порт
   → Текущий порт: grep mixed-port /opt/dostup/config.yaml

Не удаётся скачать конфиг/ядро:
   → Проверьте интернет: curl -I https://github.com
   → Проверьте URL подписки в settings.json

Mihomo падает после обновления:
   → Переустановите: sudo bash dostup-install.sh

=====================================
     УДАЛЕНИЕ (если нужно)
=====================================
Выполните: sudo dostup uninstall

Или вручную:
   sudo systemctl stop dostup
   sudo systemctl disable dostup
   sudo rm -f /etc/systemd/system/dostup.service
   sudo systemctl daemon-reload
   sudo rm -rf /opt/dostup
   sudo rm -f /usr/local/bin/dostup
